package org.cyber.utbot.api.utils.vulnerability.parsers

import com.google.gson.Gson
import com.google.gson.reflect.TypeToken
import org.cyber.utbot.api.abstraction.VulnerabilityCheck
import org.cyber.utbot.api.abstraction.VulnerabilityCheckInfo
import org.cyber.utbot.api.exceptions.CyberException
import org.cyber.utbot.api.utils.FunctionId
import java.io.File

object ConstraintsVulnerabilityChecksCreator: AbstractVulnerabilityChecksCreator() {
    private val gson = Gson()
    private val type = object : TypeToken<List<Any>>() {}.type

    private fun check(constraintsList: List<Any>): List<FunctionId> =
        throw CyberException("ConstraintsVulnerabilityChecksCreator not yet implemented")

    override fun parseVulnerabilityCheckInfo(vulnerabilityCheckInfo: VulnerabilityCheckInfo): VulnerabilityCheck {
        val functionIds = check(vulnerabilityCheckInfo.paths.map {
            gson.fromJson<List<Any>>(File(it).read(), type)
        }.flatten())
        return VulnerabilityCheck(functionIds = functionIds, description = vulnerabilityCheckInfo.description)
    }
}
