package org.cyber.utbot.api.utils.vulnerability.parsers

import com.google.gson.Gson
import com.google.gson.reflect.TypeToken
import org.cyber.utbot.api.abstraction.VulnerabilityCheck
import org.cyber.utbot.api.abstraction.VulnerabilityCheckInfo
import org.cyber.utbot.api.exceptions.CyberException
import org.cyber.utbot.api.utils.FunctionId
import java.io.File

object ArgumentsVulnerabilityChecksCreator: AbstractVulnerabilityChecksCreator() {
    private val gson = Gson()
    private val type = object : TypeToken<List<List<Any>>>() {}.type

    private fun check(argumentsList: List<List<Any>>): List<FunctionId> =
        throw CyberException("ArgumentsVulnerabilityChecksCreator not yet implemented")

    override fun parseVulnerabilityCheckInfo(vulnerabilityCheckInfo: VulnerabilityCheckInfo): VulnerabilityCheck {
        val functionIds = check(vulnerabilityCheckInfo.paths.map {
            gson.fromJson<List<List<Any>>>(File(it).read(), type)
        }.flatten())
        return VulnerabilityCheck(functionIds = functionIds, description = vulnerabilityCheckInfo.description)
    }
}
